<script>
document.addEventListener('DOMContentLoaded', () => {
  const steps = document.querySelectorAll('.step');

  // build thresholds [0, 0.01, 0.02, …, 1]
  const thresholds = Array.from({length: 101}, (_, i) => i / 100);

  const obs = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      // entry.intersectionRatio is 0→1
      const ratio = entry.intersectionRatio;
      // map that to a scale: e.g. from 0.8 → 1
      const scale = 0.8 + 0.2 * ratio;
      entry.target.style.transform = `scale(${scale})`;
    });
  }, { threshold: thresholds });

  steps.forEach(step => {
    // ensure transform-origin is center
    step.style.transformOrigin = 'center center';
    obs.observe(step);
  });
});
</script>


<div class="page">
    <%#-------------------------------------------- Header section --------------------------------------------%>
  <header style="background-image: url('<%= Image.find(1).url %>');">
  <div class="top">

  </div>
  <div class="bottom">
      <h1 class="site-title">
      Exotic<span class="break-at-mobile">Euro</span>
    </h1>
    <p>
    
      <span class="break-line">Luxury Made Affordable.</span>
      <span class="break-line">Just for You.</span>
    </p>
  </div>
</header>

    <%#--------------------------------------------------------------------------------------------------------%>


    <%#-------------------------------------------- Steps section ---------------------------------------------%>

    <section class = "step-by-step">
        <div class = "section-header">
            <h1>Step by Step Process</h1>
            <a>We make luxury affordable: from search to repair, we handle everything for you.</a>
        </div>
        <div class = "step">
            <div class = "step-text">
                <p>We discuss the the model of your car, and the initial budget.</p>
            </div>
        </div>
        <div class = "step">
            <div class = "step-text">
                <p>Our Specialists would find and inspect the requested car to determine the cost of repairs. </p>
            </div>
        </div>
        <div class = "step">
            <div class = "step-text">
                <p>Our Mechanics would repair the car to factory specs. </p>
            </div>
        </div>
        <div class = "step">
            <div class = "step-text">
                <p>Our Team delivers your dream car for the agreed budget. </p>
            </div>
        </div>
        <%= link_to "Book Consoltation",contact_path, class: "book-btn"  %>
            
      
    </section>

    <%#--------------------------------------------------------------------------------------------------------%>


    <%#-------------------------------------------- Contact section ---------------------------------------------%>
    <section class = "contact-section">
        <div class = "section-header">
            <h1> Where to Find Us</h1>
            <a>Stop by, give us a call, or send a message — we're here to help.</a>
        </div>

        <% if @user.location.present? %>
            <%= render partial: 'index/contact/contact_card_with_location', locals: { location: @user.location } %>
        <% else %>
           <%=  render partial: 'index/contact/contact_card', locals: { location: @user.location }%>
        <% end %>
    </section>

    <%#--------------------------------------------------------------------------------------------------------%>



    <%#--------------------------------------------- Credibility Section -------------------------------------%>
        <section class = "credibility-section">
            <div class = "section-header">
                <h1> What our clients say</h1>
                <a> We are proud of our work and our clients.</a>
            </div>
           
            
            <div class="before-carousel">
                <div class="before-car-slide" >
                    <div class="car-dmg car1" style = "background-image: url('<%= Image.find_by(name: "before_car_one").url %>'); "></div>
                    <div class="car-dmg car2" style = "background-image: url('<%= Image.find_by(name: "before_car_two").url %>'); "></div>
                    <div class="car-dmg car3" style = "background-image: url('<%= Image.find_by(name: "before_car_three").url %>'); "></div>
                    <div class="car-dmg car4" style = "background-image: url('<%= Image.find_by(name: "before_car_four").url %>'); "></div>
                    <div class="car-dmg car5" style = "background-image: url('<%= Image.find_by(name: "before_car_five").url %>'); "></div>
                </div>
            </div>
            
            <div class="testimony-section">
                <div class="testimony-outer active">
                    <%= render partial: 'index/testimonies/testimony_1' %>
                </div>
                <div class="testimony-outer">
                    <%= render partial: 'index/testimonies/testimony_2' %>
                </div>
                <div class="testimony-outer">
                    <%= render partial: 'index/testimonies/testimony_3' %>
                </div>
                <div class="testimony-outer">
                    <%= render partial: 'index/testimonies/testimony_4' %>
                </div>
            </div>

          
            
            <div class="after-carousel">
                <div class="after-car-slide">
                    <div class="car-fix car1-mirror" style = "background-image: url('<%= Image.find_by(name: "after_car_one").url %>'); "></div>
                    <div class="car-fix car2-mirror" style = "background-image: url('<%= Image.find_by(name: "after_car_two").url %>'); "></div>
                    <div class="car-fix car3-mirror" style = "background-image: url('<%= Image.find_by(name: "after_car_three").url %>'); "></div>
                    <div class="car-fix car4-mirror" style = "background-image: url('<%= Image.find_by(name: "after_car_four").url %>'); "></div>
                    <div class="car-fix car5-mirror" style = "background-image: url('<%= Image.find_by(name: "after_car_five").url %>'); "></div>
                </div>
            </div>
        </section>

    <%#--------------------------------------------------------------------------------------------------------%>

    <%#-------------------------------------------- Featured section ---------------------------------------------%>
    <section class = "car-section">
            <div class = "section-header" > 
                <h1> Ready-to-Go Deals </h1>
                <a> Check out our collection of existing ehicles.</a>
            </div>

            <% if @cars.present?%>
                <div class = "car-grid">
                    <% @cars.each do |car| %>
                        <div class="card">
                            <div class="card_image"><%= image_tag(car.images.find_by(id: car.display_image)&.url,alt: 'Car Image') %>
                                <div class = "shadow"></div>
                            </div>

                            <div class="card_content">
                                <h2 class = "card_title" > <%= car.car_make %> <%= car.car_model %> </h2>
                                <div class = "car_info">
                                    <h3 class = "price" > <%=number_to_currency(car.price)%> </h3> 
                                    <div class = "info-box">
                                        <% if car.compared_price.present? %>
                                            <% different = car.compared_price - car.price %>
                                            <p> <%= number_to_currency(different) %> Below Market Value </p>
                                        <% end %>
                                        <p>  <%=number_with_delimiter(car.miles, delimiter: ',')  %> mi </p>
                                    </div>
                                </div>
                                <%= button_to "More", car_path(car_id: car.id), method: :get, class: "show-btn"%>
                                
                            </div>
                        </div>
                    <% end %>
                </div>
            <% else %>
                <div class = "no-cars">
                
                    <p> We're fresh out of vehicles right now! </p>

                    <p class = "notify-form-label" > Check on us later when New Cars Arrive. </p>
                  
                </div>
            <% end %>

    </section>

        <%#--------------------------------------------------------------------------------------------------------%>
</div>




<style>
.testimony-outer {
  position: absolute;
  width: 100%; height: 100%;
  opacity: 0;
  
  /* 1) Make the whole cycle 20s (4 × 5s), repeat forever */
  /* 2) Apply ease-in-out to the animation */
  animation: fade 20s infinite ease-in-out;
}

/* stagger each testimonial by 5s */
.testimony-outer:nth-child(1) { animation-delay: 0s;  }
.testimony-outer:nth-child(2) { animation-delay: 5s;  }
.testimony-outer:nth-child(3) { animation-delay: 10s; }
.testimony-outer:nth-child(4) { animation-delay: 15s; }

/* Keyframes: 
   – 0%→20% = showing (with fade-in at 0→4%, hold until 20%)  
   – 20%→25% = fade-out  
   – 25%→100% = hidden until next cycle
*/
@keyframes fade {
  /* start fully transparent */
  0%   { opacity: 0; }
  /* fade in to full opacity over 4% of the cycle (0.8s) */
  4%   { opacity: 1; }
  /* stay fully visible until 20% of the cycle (4s) */
  20%  { opacity: 1; }
  /* fade out over the next 5% (1s) */
  25%  { opacity: 0; }
  /* remain hidden until the very end of the cycle */
  100% { opacity: 0; }
}

</style>


